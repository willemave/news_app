<p><em>By Sayash Kapoor, <a href="https://citp.princeton.edu/citp-people/benedikt-strobl/">Benedikt Stroebl</a>, Arvind Narayanan</em></p><p>Which is the most accurate AI system for generating code? Surprisingly, there isn&#8217;t currently a good way to answer questions like these.&nbsp; </p><p>Based on <a href="https://paperswithcode.com/sota/code-generation-on-humaneval">HumanEval</a>, a widely used benchmark for code generation, the most accurate publicly available system is <a href="https://arxiv.org/abs/2402.16906">LDB</a> (short for LLM debugger).<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-1" id="footnote-anchor-1" target="_self">1</a> But there&#8217;s a catch. The most accurate generative AI systems, including LDB, tend to be agents,<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-2" id="footnote-anchor-2" target="_self">2</a> which repeatedly invoke language models like GPT-4. That means they can be orders of magnitude more costly to run than the models themselves (which are already pretty costly). If we eke out a 2% accuracy improvement for 100x the cost, is that really better?</p><p>In this post, we argue that:</p><ul><li><p>AI agent accuracy measurements that don&#8217;t control for cost aren&#8217;t useful.</p></li><li><p>Pareto curves can help visualize the accuracy-cost tradeoff.</p></li><li><p>Current state-of-the-art agent architectures are complex and costly but no more accurate than extremely simple baseline agents that cost 50x less in some cases.</p></li><li><p>Proxies for cost such as parameter count are misleading if the goal is to identify the best system for a given task. We should directly measure dollar costs instead.</p></li><li><p>Published agent evaluations are difficult to reproduce because of a lack of standardization and questionable, undocumented evaluation methods in some cases.</p><p></p></li></ul><h4><strong>Maximizing accuracy can lead to unbounded cost</strong></h4><p>LLMs are stochastic. Simply calling a model <a href="https://arxiv.org/abs/2402.05120">many</a> <a href="https://arxiv.org/pdf/2403.02419.pdf">times</a> and outputting the most common answer can increase accuracy.&nbsp;</p><p>On some tasks, there is seemingly no limit to the amount of inference compute that can improve accuracy.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-3" id="footnote-anchor-3" target="_self">3</a> Google Deepmind's <a href="https://arxiv.org/pdf/2203.07814.pdf">AlphaCode</a>, which improved accuracy on automated coding evaluations, showed that this trend holds even when calling LLMs millions of times.</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa22df54d-213b-44da-aacd-a55fb24f9089_688x544.jpeg" target="_blank"><div class="image2-inset"><source type="image/webp" /><img alt="" class="sizing-normal" height="373.2093023255814" src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa22df54d-213b-44da-aacd-a55fb24f9089_688x544.jpeg" width="472" /><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg class="lucide lucide-refresh-cw" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg class="lucide lucide-maximize2" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption"><em>The accuracy of <a href="https://arxiv.org/pdf/2203.07814.pdf">AlphaCode</a> on coding tasks continues to improve even after making a million calls to the underlying model (the different curves represent varying parameter counts). Accuracy is measured by how often one of the top 10 answers generated by the model is correct.</em></figcaption></figure></div><p>A useful evaluation of agents must therefore ask: What did it cost? If we don&#8217;t do cost-controlled comparisons, it will encourage researchers to develop extremely costly agents just to claim they topped the leaderboard.</p><p>In fact, when we evaluate agents that have been proposed in the last year for solving coding tasks, we find that visualizing the tradeoff between cost and accuracy yields surprising insights.&nbsp;</p><div class="subscription-widget-wrap-editor"><div class="subscription-widget show-subscribe"><div class="preamble"><p class="cta-caption">Subscribe to AI Snake Oil receive new posts.</p></div><form class="subscription-widget-subscribe"><input class="email-input" name="email" tabindex="-1" type="email" /><input class="button primary" type="submit" value="Subscribe" /><div class="fake-input-wrapper"><div class="fake-input"></div><div class="fake-button"></div></div></form></div></div><p></p><h4><strong>Visualizing the accuracy-cost tradeoff on HumanEval, with new baselines</strong></h4><p>We re-evaluated the accuracy of three agents that have been claimed to occupy top spots on the HumanEval leaderboard: <a href="https://arxiv.org/pdf/2402.16906v3.pdf">LDB</a>, <a href="https://arxiv.org/pdf/2310.04406v2.pdf">LATS</a>, and <a href="https://arxiv.org/pdf/2303.11366.pdf">Reflexion</a>.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-4" id="footnote-anchor-4" target="_self">4</a> We also evaluated the cost and time requirements of running these agents.&nbsp;</p><p>These agents rely on running the code generated by the model, and if it fails the test cases provided with the problem description, they try to debug the code, look at alternative paths in the code generation process, or "reflect" on why the model's outputs were incorrect before generating another solution.&nbsp;</p><p>In addition, we calculated the accuracy, cost, and running time of&nbsp; a few simple baselines:&nbsp;</p><ul><li><p><strong>GPT-3.5</strong> and <strong>GPT-4 </strong>models (zero shot; no agent architecture<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-5" id="footnote-anchor-5" target="_self">5</a>)</p></li><li><p><strong>Retry:</strong> We repeatedly invoke a model with the temperature set to zero, up to five times, if it fails the test cases provided with the problem description.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-6" id="footnote-anchor-6" target="_self">6</a> Retrying makes sense because LLMs <a href="https://community.openai.com/t/run-same-query-many-times-different-results/140588#:~:text=Apr%202023-,OpenAI%20models%20are%20non%2Ddeterministic%2C%20meaning%20that%20identical%20inputs%20can%20yield,amount%20of%20variability%20may%20remain%20due%20to%20GPU%20floating%20point%20math.,-Solution">aren&#8217;t deterministic</a> even at temperature zero.</p></li><li><p><strong>Warming: </strong>This is the same as the retry strategy, but we gradually increase the temperature of the underlying model with each run, from 0 to 0.5. This increases the stochasticity of the model and, we hope, increases the likelihood that at least one of the retries will succeed.</p></li><li><p><strong>Escalation:</strong> We start with a cheap model (Llama-3 8B) and escalate to more expensive models (GPT-3.5, Llama-3 70B, GPT-4) if we encounter a test case failure.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-7" id="footnote-anchor-7" target="_self">7</a></p></li></ul><p>Surprisingly, we are not aware of any papers that compare their proposed agent architectures with any of the latter three simple baselines.</p><p>Our most striking result is that <strong>agent architectures for HumanEval do not outperform our simpler baselines despite costing more</strong>. In fact, agents differ drastically in terms of cost: for substantially similar accuracy, the cost can differ by almost two orders of magnitude!<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-8" id="footnote-anchor-8" target="_self">8</a> Yet, the cost of running these agents isn't a top-line metric reported in any of these papers.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-9" id="footnote-anchor-9" target="_self">9</a></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdcb16a9f-29bd-47a4-813e-929685ce3fd8_1029x705.png" target="_blank"><div class="image2-inset"><source type="image/webp" /><img alt="" class="sizing-normal" height="430.26239067055394" src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdcb16a9f-29bd-47a4-813e-929685ce3fd8_1029x705.png" width="628" /><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg class="lucide lucide-refresh-cw" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg class="lucide lucide-maximize2" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption"><em>Our simple baselines offer Pareto improvements over existing agent architectures.&nbsp;We run each agent five times and report the mean accuracy and the mean total cost on the 164 HumanEval problems. Where results for LDB have two models/agents in parenthesis, they indicate the language model or agent used to generate the code, followed by the language model used to debug the code. Where they have just one, they indicate that the same model was used to both generate the code and debug it. Note that the y-axis is shown from 0.7 to 1; figures with the full axis (0 to 1) and error bars, robustness checks, and other details about our empirical results are included in the <a href="https://www.cs.princeton.edu/~sayashk/papers/ai-leaderboards-appendix.pdf">appendix</a>.&nbsp;</em></figcaption></figure></div><p>There is no significant accuracy difference between the warming strategy and the best-performing agent architecture. Yet, Reflexion and LDB cost over 50% more than the warming strategy,<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-10" id="footnote-anchor-10" target="_self">10</a> and LATS over 50 times more (all these costs are entirely or predominantly from calls to GPT-4, so these ratios will be stable even if model costs change).&nbsp; Meanwhile, the escalation strategy strictly improves accuracy while costing less than half of LDB (GPT-3.5) at current inference prices.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-11" id="footnote-anchor-11" target="_self">11</a>&nbsp;</p><p>Our results point to another underlying problem: papers making claims about the usefulness of agents have so far failed to test if simple agent baselines can lead to similar accuracy. This has led to widespread beliefs among AI researchers that complex ideas like planning, reflection, and debugging are responsible for accuracy gains. In fact, Lipton and Steinhardt noted a trend in the AI literature of failing to identify the sources of empirical gains <a href="https://arxiv.org/abs/1807.03341">back in 2018</a>.</p><p>Based on our findings, the question of whether debugging, reflection, and other such &#8220;System 2&#8221; approaches are useful for code generation remains open.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-12" id="footnote-anchor-12" target="_self">12</a> It is possible that they will be useful on harder programming tasks than those represented in HumanEval. For now, the over-optimism about System 2 approaches is exacerbated by a lack of reproducibility and standardization that we report below.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-13" id="footnote-anchor-13" target="_self">13</a></p><h4><strong>Proxies for cost are misleading</strong></h4><p>At first glance, reporting dollar costs is jarring. It breaks many properties of benchmarking that we take for granted: that measurements don&#8217;t change over time (whereas costs tend to come down) and that different models compete on a level playing field (whereas some developers may <a href="https://papers.nips.cc/paper_files/paper/2023/file/d1a14493e5f84d6c6129414f0cd1a7c6-Paper-Conference.pdf">benefit</a> from economies of scale, leading to lower inference costs). Because of this, researchers usually pick a different axis for the Pareto curve, such as parameter count.</p><p>The downsides of reporting costs are real, but we describe below how they can be mitigated. More importantly, we think using attributes like parameter count as a proxy for cost is a mistake and doesn&#8217;t solve the problem it&#8217;s intended to solve. To understand why, we need to introduce a conceptual distinction.</p><p>AI evaluations serve at least two distinct purposes. Model developers and AI researchers use them to identify which changes to the training data and architecture improve accuracy. We call this <a href="https://arxiv.org/pdf/2211.09110">model evaluation</a>. And downstream developers, such as programmers who use AI to build consumer-facing products, use evaluations to decide which AI systems to use in their products. We call this <a href="https://www.arthur.ai/product/bench">downstream evaluation</a>.&nbsp;</p><p>The difference between model evaluation and downstream evaluation is underappreciated. This has led to much confusion about how to factor in the cost of running AI.</p><p>Model evaluation is a scientific question of interest to researchers. So it makes sense to stay away from dollar costs for the aforementioned reasons. Instead, controlling for compute is a reasonable approach: if we normalize the amount of compute used to train a model, we can then understand if factors like architectural changes or changes in the data composition are responsible for improvements, as opposed to more compute. Notably, Nathan Lambert <a href="https://www.interconnects.ai/p/compute-efficient-open-llms">argues</a> that many of the accuracy gains in the last year (such as Meta's Llama 2) are simply consequences of using more compute.&nbsp;</p><p>On the other hand, downstream evaluation is an engineering question that helps inform a procurement decision. Here, cost is the actual construct of interest. The downsides of cost measurement aren&#8217;t downsides at all; they are exactly what&#8217;s needed. Inference costs do come down over time, and that greatly matters to downstream developers. It is unnecessary and counterproductive for the evaluation to stay frozen in time.</p><p>In this context, proxies for cost (such as the number of active parameters or amount of compute used) are misleading. For example, Mistral <a href="https://mistral.ai/news/mixtral-8x22b/">released</a> the figure below alongside their latest model, Mixtral 8x22B, to explain why developers should choose it over competitors.&nbsp;</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F019ad4b8-e42b-4f9b-9d91-cb3ccc84fa3a_1030x640.jpeg" target="_blank"><div class="image2-inset"><source type="image/webp" /><img alt="" class="sizing-normal" height="349.20388349514565" src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F019ad4b8-e42b-4f9b-9d91-cb3ccc84fa3a_1030x640.jpeg" width="562" /><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg class="lucide lucide-refresh-cw" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg class="lucide lucide-maximize2" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption"><em>Substituting active parameters as a proxy for cost is misleading. Source: <a href="https://mistral.ai/news/mixtral-8x22b/">Mistral</a>.</em></figcaption></figure></div><p>In this figure, the number of active parameters is a poor proxy for cost. On <a href="https://docs.endpoints.anyscale.com/pricing/">Anyscale</a>, Mixtral 8x7B costs twice as much as Llama 2 13B, yet Mistral's figure shows it costs about the same, because they only consider the number of active parameters. Of course, downstream developers don't care about the number of active parameters when they're using an API. They simply care about the dollar cost relative to accuracy. Mistral chose &#8220;active parameters&#8221; as a proxy, presumably because it makes their models look better than dense models such as Meta&#8217;s Llama and Cohere&#8217;s Command R+. If we start using proxies for cost, every model developer can pick a proxy that makes their model look good.</p><p>Some hurdles to cost evaluation remain. Different providers can charge different amounts for <a href="https://docs.endpoints.anyscale.com/pricing/">the</a> <a href="https://www.together.ai/pricing">same</a> <a href="https://replicate.com/pricing">model</a>, the cost of an API call might change <a href="https://openai.com/blog/new-models-and-developer-products-announced-at-devday">overnight</a>, and cost might vary based on model developer decisions, such as whether <a href="https://twitter.com/OpenAIDevs/status/1779922566091522492?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1779922566091522492%7Ctwgr%5E100b538f87ce81b828a23634fa12d127c126b5ba%7Ctwcon%5Es1_c10&amp;ref_url=https%3A%2F%2Fwww.theverge.com%2F2024%2F4%2F15%2F24131401%2Fopenai-will-give-you-a-50-percent-discount-for-off-peak-gpt-use">bulk API</a> calls are charged differently. These downsides can be partly addressed by making the evaluation results customizable using mechanisms to adjust the cost of running models, i.e., providing users the option to adjust the cost of input and output tokens for their provider of choice to recalculate the tradeoff between cost and accuracy. In turn, downstream evaluations of agents should include input/output token counts in addition to dollar costs, so that anyone looking at the evaluation in the future can instantly recalculate the cost using current prices.</p><p>But ultimately, despite the hurdles, good measurement requires modeling the underlying construct of interest. For downstream evaluations, that underlying construct is cost. All other proxies are lacking.</p><h4><strong>Agent evaluations lack standardization and reproducibility</strong></h4><p>In the course of our evaluation, we found many shortcomings in the reproducibility and standardization of agent evaluations.</p><ul><li><p><strong>We were unable to reproduce the results of the LATS and LDB agents on HumanEval.</strong> In particular, across all 5 runs for LDB (Reflexion, GPT-3.5), the maximum accuracy was 91.5%, much lower than the 95.1% reported in the paper.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-14" id="footnote-anchor-14" target="_self">14</a> The maximum accuracy of LATS across all five runs was similarly lower, at 91.5% instead of 94.4%.&nbsp;</p></li><li><p>Similarly, the accuracy for the baseline GPT-4 model reported in the LDB paper is drastically lower than our reproduction of the paper's code (75.0% vs. a mean of 89.6% across five runs). In fact, according to the paper, the GPT-3.5 and GPT-4 models perform very similarly (73.9% vs. 75.0%).<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-15" id="footnote-anchor-15" target="_self">15</a> Weak baselines could give a false sense of the amount of improvement attributable to the agent architecture.</p></li><li><p>The LATS agent was evaluated on only a <a href="https://github.com/andyz245/LanguageAgentTreeSearch/blob/554886901183a9908183d2cb104c3088c493650a/programming/mcts.py#L138C1-L138C29">subset</a> of the test cases provided in the HumanEval benchmark. This exaggerated their accuracy numbers, since the code for a particular HumanEval problem might be incorrect, but if it passes only a portion of the test cases for that problem, it could still be marked as correct. In our analysis, this was responsible for a 3% difference in accuracy (mean across five runs), which explains a substantial part of the difference between the accuracy we found and the one reported in the paper. In addition, many details about the implementation, such as hyperparameter values, were not reported in the paper or GitHub repository (see <a href="https://www.cs.princeton.edu/~sayashk/papers/ai-leaderboards-appendix.pdf">appendix</a> for details).</p></li><li><p>To the best of our knowledge, this post is the first time the four agents with the highest accuracy&#8212;Retry, Warming, LDB (GPT-4), and LDB (GPT-4 + Reflexion)&#8212;have been tested on HumanEval.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-16" id="footnote-anchor-16" target="_self">16</a>&nbsp;</p></li><li><p><strong>Reflexion, LDB, and LATS all use different subsets of HumanEval.</strong> Three (out of 164) coding problems in the original version of HumanEval lack example tests. Since these agents require example tests to debug or rerun their solutions, Reflexion removes the three problems that don't have example tests. LATS removes these three problems, plus another problem, for unreported reasons.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-17" id="footnote-anchor-17" target="_self">17</a> LDB adds example tests for the three problems that are missing in the original benchmark. <strong>None of the three papers reports this. </strong>The paper introducing LATS claims (incorrectly): "We use all 164 problems for our experiments."<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-18" id="footnote-anchor-18" target="_self">18</a> In our analysis, we conducted all evaluations on the version of the benchmark provided by LDB, since it contains example tests for all problems.</p></li><li><p>The LDB paper claims to use GPT-3.5 for code generation using Reflexion: "For Reflexion, we select the version based on GPT-3.5 and utilize the corresponding generated programs published in the official Github repository." However, the <a href="https://github.com/noahshinn/reflexion/blob/d15acda1c81d464d9a81648d7f29fb951e326c70/programming_runs/root/reflexion_humaneval_py_pass_at_1/reflexion_humaneval_py_pass_at_1.jsonl">generated program</a> they used from the Reflexion repository relies on GPT-4 for code generation, not GPT-3.5.<a class="footnote-anchor" href="https://www.aisnakeoil.com/feed#footnote-19" id="footnote-anchor-19" target="_self">19</a>&nbsp;</p></li></ul><p>These shortcomings in the empirical results have also led to errors of interpretation in broader discussions around the accuracy of AI agents. For example, a recent <a href="https://www.deeplearning.ai/the-batch/issue-241/">post</a> by Andrew Ng claimed that agents that use GPT-3.5 can outperform GPT-4. In particular, he claimed:&nbsp;</p><blockquote><p><em>[For HumanEval,] GPT-3.5 (zero shot) was 48.1% correct. GPT-4 (zero shot) does better at 67.0%. However, the improvement from GPT-3.5 to GPT-4 is dwarfed by incorporating an iterative agent workflow. Indeed, wrapped in an agent loop, GPT-3.5 achieves up to 95.1%.&nbsp;</em></p></blockquote><p>While this claim received a lot of attention, it is incorrect. The claim ("GPT-3.5 wrapped in an agent workflow achieves 95.1% accuracy") seems to be about the LDB agent. The <a href="https://paperswithcode.com/sota/code-generation-on-humaneval">Papers With Code leaderboard</a> for HumanEval makes the same claim. However, as we discussed above, for LDB, GPT-3.5 is only used to find bugs. The code is generated using GPT-4 (or the Reflexion agent that uses GPT-4), not GPT-3.5. Unfortunately, the error in the paper has led to much overoptimism about agents in the broader AI community.</p><p>Ng's post also makes the familiar error of repeating results from papers without verifying them or accounting for changes in prompts and model versions. For example, the zero-shot accuracy numbers of GPT-3.5 (48.1%) and GPT-4 (67.0%) seem to be copied from the <a href="https://arxiv.org/abs/2303.08774">GPT-4 technical report</a> from March 2023. However, the models have been updated many times since release. Indeed, in our comparison, we find that the base models perform much better compared to the claimed figures in Ng's post when we use them with the prompts provided with the LDB paper (GPT-3.5: 73.9%, GPT-4: 89.6%). As a result, the post drastically overestimates the improvement attributable to agent architectures.</p><p>Evaluation frameworks like Stanford's <a href="https://crfm.stanford.edu/helm/lite/latest/">HELM</a> and EleutherAI's <a href="https://www.eleuther.ai/projects/large-language-model-evaluation">LM Evaluation Harness</a> attempt to fix similar shortcomings for model evaluations, by providing standardized evaluation results. We are working on solutions to make agent evaluations standardized and reproducible, especially from the perspective of downstream evaluation of agents.</p><p>Finally, downstream developers should keep in mind that HumanEval or any other standardized benchmark is nothing more than a rough proxy for the specific tasks that arise in a particular downstream application. To understand how agents will perform in practice, it is necessary to evaluate them on a <a href="https://arxiv.org/abs/2404.12272">custom dataset</a> from the domain of interest &#8212; or even better, A/B test different agents in the production environment.</p><h4><strong>Further reading</strong></h4><ul><li><p><a href="https://bair.berkeley.edu/blog/2024/02/18/compound-ai-systems/">Zaharia et al.</a> observe that state-of-the-art accuracy on AI benchmarks is often attained by composite systems. If the adoption of agents continues, visualizing cost and accuracy as a Pareto curve would become even more necessary.</p></li><li><p><a href="https://arxiv.org/pdf/2212.01340.pdf">Santhanam et al.</a> point out the importance of evaluating cost alongside accuracy for information retrieval benchmarks.</p></li><li><p><a href="https://arxiv.org/html/2404.12387v1">Ozrmazabal et al.</a> highlight the <a href="https://arxiv.org/html/2404.12387v1#:~:text=Figure%201%3A,different%20LLM%20APIs.">accuracy vs. cost per output token tradeoffs</a> for various models (but not agents) on MMLU. While the cost of output tokens might not be a good indicator of the overall cost, given the varying input token costs as well as output lengths for different models, it is better than not reporting the tradeoffs at all.&nbsp;</p></li><li><p>The <a href="https://gorilla.cs.berkeley.edu/leaderboard.html">Berkeley Function Calling leaderboard</a> includes various metrics for language model evaluations of function calling, including cost and latency.</p></li><li><p><a href="https://arxiv.org/pdf/2404.07972.pdf">Xie et al.</a> develop OSWorld, a benchmark for evaluating agents in computer environments. In their <a href="https://github.com/xlang-ai/OSWorld">GitHub repository</a> (though not in the paper), they give a rough cost estimate for running various multimodal agents on their benchmark.</p></li><li><p>Unsurprisingly, the main impetus for cost vs. accuracy tradeoffs has come from the <a href="https://x.com/swyx/status/1772799201023557697">downstream developers</a> who <a href="https://x.com/jaredpalmer/status/1783899239140986884">use AI</a>.</p></li><li><p>In a previous talk, we discussed <a href="https://www.cs.princeton.edu/~arvindn/talks/evaluating_llms_minefield/">three major pitfalls</a> in LLM evaluation: prompt sensitivity, construct validity, and contamination. The current research is largely orthogonal: prompt sensitivity isn&#8217;t a concern for agent evaluation (as agents are allowed to define their own prompts); downstream developers can address contamination and construct validity by evaluating on custom datasets.</p></li></ul><p>The code for reproducing our analysis is available <a href="https://github.com/benediktstroebl/agent-eval">here</a>. The <a href="https://www.cs.princeton.edu/~sayashk/papers/ai-leaderboards-appendix.pdf">appendix</a> includes more details about our setup and results.</p><h4><strong>Acknowledgments</strong></h4><p>We thank Rishi Bommasani, Rumman Chowdhury, Percy Liang, Shayne Longpre, Yifan Mai, Nitya Nadgir, Matt Salganik, Hailey Schoelkopf, Zachary Siegel, and Venia Veselovsky for discussions and inputs that informed our analysis. We acknowledge Cunxiang Wang and Ruoxi Ning for their prompt responses to our questions about the NovelQA benchmark.&nbsp;</p><p>We are grateful to the authors of the papers we engage with in this post for their quick responses and for sharing their code, which makes such reproduction analysis possible in the first place. In particular, we are grateful to Zilong Wang (LDB), Andy Zhou (LATS), and Karthik Narasimhan (Reflexion), who gave us feedback in response to an earlier draft of this blog post.</p><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-1" id="footnote-1" target="_self">1</a><div class="footnote-content"><p>The leaderboard on the linked page lists <a href="https://paperswithcode.com/paper/agentcoder-multi-agent-based-code-generation">AgentCoder</a> as the most accurate system. However, the code or data for reproducing the results of this agent are not available online, so we do not consider it in this blog post.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-2" id="footnote-2" target="_self">2</a><div class="footnote-content"><p>This post is about agents. Leaderboards are also becoming less useful for evaluating the <a href="https://www.arthur.ai/blog/whats-going-on-with-llm-leaderboards">underlying</a> <a href="https://aclanthology.org/2020.emnlp-main.393/">models</a>. There are many problems, including gameability. But controlling for inference cost isn&#8217;t the main problem, so our arguments don&#8217;t necessarily apply.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-3" id="footnote-3" target="_self">3</a><div class="footnote-content"><p>Tasks where increased compute could help indefinitely are primarily those where verifying whether a solution is correct is easy. In the case of programming questions, this takes the form of test cases that are provided with each question to check if the answer is correct. Other examples include proving theorems, because verifying if a theorem is correct can be straightforward, as well as <a href="https://arxiv.org/pdf/2404.06474.pdf">some tasks on the internet</a> for agents that navigate the web. That said, even for tasks where there is no way to guess a solution and then verify, the costs of different agents can vary by orders of magnitude.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-4" id="footnote-4" target="_self">4</a><div class="footnote-content"><p>We included agents from the HumanEval leaderboard on <a href="https://paperswithcode.com/sota/code-generation-on-humaneval">PapersWithCode</a> that share their code publicly. Reflexion is absent from the PapersWithCode list, but it has a reported accuracy of 91% (higher than any other agents with publicly available code apart from LDB and LATS), so we included it too.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-5" id="footnote-5" target="_self">5</a><div class="footnote-content"><p>For the model evaluation, we only used the description of the coding problem as well as the example tests provided with the HumanEval dataset. Three of the 164 coding problems in HumanEval lack example tests. The authors of LDB include a modified version of HumanEval with example tests included for these three problems. We use this modified version for all experiments.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-6" id="footnote-6" target="_self">6</a><div class="footnote-content"><p>In all of the baselines we provide, we don't use the test cases used to evaluate if the solution is correct when deciding to retry, only the ones in the problem description, to avoid <a href="https://reproducible.cs.princeton.edu/">leakage</a>.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-7" id="footnote-7" target="_self">7</a><div class="footnote-content"><p>We evaluated Llama-3 using together.ai endpoints. The <a href="https://api.together.xyz/models">cost per million tokens on together.ai</a>, for both prompt and completion, is 0.20$ and 0.90$ for Llama-3-8B and Llama-3-70B, respectively.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-8" id="footnote-8" target="_self">8</a><div class="footnote-content"><p>This is also true for other desired properties of agents, such as running time. We report results for time vs. accuracy tradeoffs in the <a href="https://www.cs.princeton.edu/~sayashk/papers/ai-leaderboards-appendix.pdf">appendix</a>.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-9" id="footnote-9" target="_self">9</a><div class="footnote-content"><p>While some of the papers introducing these models discuss cost abstractly, such as the relationship between cost and number of times an agent retries, they don't report any concrete numbers on cost or compare token count to a baseline.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-10" id="footnote-10" target="_self">10</a><div class="footnote-content"><p>The cost comparison is for LDB (Reflexion, GPT-3.5), since that is the top-performing agent reported by the authors of LDB.&nbsp;</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-11" id="footnote-11" target="_self">11</a><div class="footnote-content"><p>In addition to HumanEval, we also ran experiments on the HotPotQA and NovelQA benchmarks for question answering. We found similar results for both benchmarks. In particular, we found that there can be large differences in cost underlying small improvements in accuracy for both benchmarks.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-12" id="footnote-12" target="_self">12</a><div class="footnote-content"><p>One potential concern with our analysis is that while we relied on the April 2024 version of OpenAI models, many papers relied on older model versions for their results. To address this, we report results for an additional robustness check with the June 2023 version of OpenAI models in the <a href="https://www.cs.princeton.edu/~sayashk/papers/ai-leaderboards-appendix.pdf">appendix</a>; we find substantially similar results across model versions.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-13" id="footnote-13" target="_self">13</a><div class="footnote-content"><p>While HumanEval is commonly used to evaluate how well AI can solve coding problems, it is limited due to its small size (only 164 questions), lack of difficult problems (none of the problems involve real-world tasks), and potential <a href="https://arxiv.org/pdf/2311.04850.pdf">contamination</a>, since language models have likely been trained on HumanEval problems, which might inflate the performance of the simple baselines we test. A more rigorous examination of hypotheses related to whether System 2 thinking helps will likely require the use of more comprehensive and robust benchmarks, such as <a href="https://www.swebench.com/">SWE-bench</a>.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-14" id="footnote-14" target="_self">14</a><div class="footnote-content"><p>LDB uses already-existing solutions to improve them by debugging. The existing solutions can come from models like GPT-3.5 or GPT-4, or from agents like Reflexion. Since the authors of Reflexion provided all of the generated solutions in their Github repo, the authors of the LDB paper used code from the original Reflexion repository to run their analysis, rather than rerunning the Reflexion agent. The difference between the reported results and our reproduced results could be due to differences in the code generated by the Reflexion agent. Reusing Reflexion solutions is a reasonable choice for evaluating the usefulness of debugging (indeed, we see LDB increases the accuracy over using the models alone). The problem arises when their final accuracy is interpreted as a downstream evaluation, since it might give developers an inflated estimate of the accuracy of such techniques for coding.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-15" id="footnote-15" target="_self">15</a><div class="footnote-content"><p>The authors acknowledge this and plan to update their results.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-16" id="footnote-16" target="_self">16</a><div class="footnote-content"><p>The authors of LDB only tested the GPT-3.5 model as the debugger, which performed notably worse than the agent using GPT-4 as the debugger, with an accuracy of 88.9% for LDB (GPT-3.5 + Reflexion) vs. 92.9% for LDB (GPT-4 + Reflexion).</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-17" id="footnote-17" target="_self">17</a><div class="footnote-content"><p>In correspondence with the authors of LATS, they clarified: "Originally, there was an execution error when evaluating some test cases for [one of the HumanEval test cases], so we opted to remove it from our setting."</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-18" id="footnote-18" target="_self">18</a><div class="footnote-content"><p>The authors acknowledge this and plan to update the paper to address it.</p></div></div><div class="footnote"><a class="footnote-number" contenteditable="false" href="https://www.aisnakeoil.com/feed#footnote-anchor-19" id="footnote-19" target="_self">19</a><div class="footnote-content"><p>The authors acknowledge this and plan to update the paper to address it.</p><p></p></div></div>