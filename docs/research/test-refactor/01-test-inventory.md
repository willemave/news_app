# Test Inventory, Coverage Mapping, and Refactor Notes

Scope: `tests/` (142 test modules, 882 passing tests, 0 skipped)

## Test Type Summary

- `api-integration`: 32 files
- `contract-or-unit`: 21 files
- `integration`: 6 files
- `pipeline-integration`: 15 files
- `unit`: 66 files

## Coverage Summary (Mapped Targets)

- Average mapped target coverage across test files: 83.2%
- Files mapped to targets under 60% coverage: 5

## File-by-File Notes

| Test File | Type | Under Test | What Is Being Tested | Compare vs Class Under Test | Improve/Delete Note |
|---|---|---|---|---|---|
| `tests/core/test_admin_password.py` | unit | `app.core.security`, `app.core.settings` (avg coverage 93.4%) | verify admin password case sensitive; verify admin password correct; verify admin password empty string; verify admin password incorrect | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/core/test_deps.py` | unit | `app.core.deps`, `app.core.security` (avg coverage 91.5%) | get current user inactive user; get current user invalid token; get current user nonexistent user; get current user refresh token; get current user valid token | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/core/test_deps_admin.py` | unit | `app.core.deps`, `app.routers.auth` (avg coverage 86.2%) | require admin expired session; require admin invalid session; require admin no cookie; require admin valid session | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/core/test_logging.py` | unit | `app.core.logging` (avg coverage 93.1%) | basic error payload; converts to lowercase; formats as valid json; handles none values; handles numeric values; +26 more | Direct class-level coverage present | Improve: split into smaller focused test modules |
| `tests/core/test_security.py` | unit | `app.core.security`, `app.core.settings` (avg coverage 93.4%) | create access token; create refresh token; verify apple token missing required claims; verify apple token mvp decode; verify token expired; +2 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/core/test_settings_elevenlabs_alias.py` | contract-or-unit | `app.core.settings` (avg coverage 94.9%) | settings accept legacy elevenlabs env alias | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/core/test_settings_pdf_model.py` | unit | `app.core.settings`, `app.processing_strategies` (avg coverage 97.5%) | pdf gemini model default; pdf gemini model invalid; pdf strategy uses settings model | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/core/test_storage_paths.py` | unit | `app.core.settings` (avg coverage 94.9%) | logs dir from settings; settings default directories | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/domain/test_converters.py` | unit | `app.domain.converters`, `app.models.metadata` (avg coverage 90.7%) | article round trip; convert article content; convert content with empty metadata; convert failed content; convert failed domain content; +9 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/http_client/test_robust_http_client.py` | unit | `app.http_client.robust_http_client` (avg coverage 80.5%) | close closes underlying httpx client; get allows custom timeout headers and redirects; get http status error is raised; get retries hostname mismatch by removing www; get stream mode enters stream context; +3 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/integration/test_auth_protected_endpoints.py` | integration | `app.main`, `app.core.security` (avg coverage 91.2%) | api endpoints require authentication; authenticated requests accepted; expired token rejected; invalid token rejected | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/integration/test_convert_workflow.py` | integration | `app.models.metadata`, `app.models.schema` (avg coverage 88.9%) | convert marks news as favorite interaction; full convert workflow | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/integration/test_pipeline_integration.py` | integration | `app.pipeline.worker`, `app.pipeline.sequential_task_processor` (avg coverage 80.3%) | concurrent processing; end to end scraping and processing; failed task retry mechanism; full article processing pipeline; pipeline error recovery | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/integration/test_pipeline_with_fixtures.py` | integration | `app.pipeline.worker`, `app.models.schema` (avg coverage 83.1%) | article metadata preservation; completed article structure matches fixture; process article with real structure; process podcast with real structure; processing different content types; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/integration/test_search_api.py` | integration | `app.core.db`, `app.core.deps` (avg coverage 85.3%) | app; search basic; search pagination; search type filter; search validation; +1 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/integration/test_user_data_isolation.py` | integration | `app.models.user`, `app.core.db` (avg coverage 87.8%) | favorite action only affects current user; users see only their own favorites; users see only their own read status | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/models/test_content.py` | unit | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | article workflow simulation; content checkout mechanism; content creation article; content creation news; content creation podcast; +18 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/models/test_content_short_summary.py` | unit | `app.models.schema`, `app.models.metadata` (avg coverage 89.0%) | content short summary; content short summary missing metadata | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/models/test_editorial_narrative_summary.py` | unit | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | editorial narrative summary maps to common detail fields | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/models/test_long_bullets_summary.py` | unit | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | long bullets summary points and quotes | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/models/test_news_metadata_title_sanitization.py` | unit | `app.models.metadata`, `app.models.schema` (avg coverage 90.7%) | content data normalizes noisy news article title; content to domain handles noisy news article title | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/models/test_news_summary_deprecation.py` | unit | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | news summary ignores legacy fields | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/pipeline/test_content_worker.py` | pipeline-integration | `app.pipeline.worker`, `app.models.metadata` (avg coverage 61.1%) | init; process article marks failed on crawl fallback; process article sync extraction error; process article sync no strategy; process article sync non retryable error; +7 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_fetch_discussion_handler.py` | pipeline-integration | `app.pipeline.handlers.fetch_discussion`, `app.pipeline.handlers` (avg coverage 95.8%) | handler propagates retryability on failure; handler returns non retryable when content id missing; handler returns ok on success | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_pipeline_smoke.py` | pipeline-integration | `app.pipeline.worker`, `app.pipeline.sequential_task_processor` (avg coverage 86.7%) | scrape to completion smoke | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/pipeline/test_podcast_transcribe_worker.py` | pipeline-integration | `app.pipeline.podcast_workers`, `app.models.metadata` (avg coverage 79.5%) | cleanup service; get transcription service initialization; get transcription service initialization error; process transcribe task content not found; process transcribe task file not found; +3 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_podcast_workers.py` | pipeline-integration | `app.pipeline.podcast_workers`, `app.models.metadata` (avg coverage 79.5%) | apple podcasts resolution fills audio url; youtube audio download queues transcribe | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/pipeline/test_process_content_handler.py` | pipeline-integration | `app.pipeline.handlers.process_content`, `app.pipeline.handlers` (avg coverage 94.2%) | non terminal failure remains retryable; terminal status is treated as completed task | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_sequential_task_processor.py` | pipeline-integration | `app.pipeline.sequential_task_processor`, `app.pipeline.task_models` (avg coverage 92.0%) | init; process task dispatches; process task exception handling; process task sets default error message; run empty queue backoff; +8 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_summarization_metadata_update.py` | pipeline-integration | `app.models.metadata`, `app.pipeline.handlers.summarize` (avg coverage 90.5%) | summarize task handles missing content; summarize task handles missing text; summarize task updates article metadata; summarize task updates news metadata; summarize task updates podcast metadata | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_summarize_task_routing.py` | pipeline-integration | `app.pipeline.handlers.summarize`, `app.pipeline.task_context` (avg coverage 94.6%) | summarize article enqueues image; summarize article falls back to content to summarize; summarize news does not enqueue image tasks; summarize no text marks content skipped without retry; summarize non retryable exception marks failed; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_sync_integration_handler.py` | pipeline-integration | `app.pipeline.handlers.sync_integration`, `app.pipeline.handlers` (avg coverage 91.9%) | sync integration runs when feature enabled; sync integration skips when feature disabled | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_task_dispatcher.py` | pipeline-integration | `app.pipeline.dispatcher`, `app.pipeline.task_context` (avg coverage 97.6%) | dispatcher calls handler; dispatcher returns error for unknown handler; task envelope normalizes payload none; task envelope parses queue data | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/pipeline/test_task_retry_policy.py` | pipeline-integration | `app.pipeline.sequential_task_processor`, `app.pipeline.task_models` (avg coverage 92.0%) | run single task retries retryable failure; run single task skips retry for non retryable failure | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/pipeline/test_worker_gate_page_fallback.py` | pipeline-integration | `app.pipeline.worker`, `app.domain.converters` (avg coverage 85.1%) | process article fails gate page without rss fallback; process article uses rss fallback for gate page | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/pipeline/test_worker_terminal_paths.py` | pipeline-integration | `app.pipeline.worker`, `app.domain.converters` (avg coverage 85.1%) | handle canonical integrity conflict marks content skipped; process content handles integrity error from worker; update canonical url marks existing content id | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/pipeline/test_worker_with_fixtures.py` | pipeline-integration | `app.pipeline.worker`, `app.models.metadata` (avg coverage 80.5%) | completed fixture has valid summary structure; extract content metadata from article fixture; extract podcast metadata from fixture; fixture content types and statuses; worker processing with article fixture; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/presenters/test_content_presenter.py` | unit | `app.presenters.content_presenter`, `app.models.metadata` (avg coverage 89.0%) | primary topic blank topic falls back to platform for news; primary topic fallback to platform for news; primary topic falls back to content row platform for news; primary topic from interleaved topics; primary topic from topics list; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_arxiv_strategy.py` | unit | `app.processing_strategies.arxiv_strategy`, `app.http_client.robust_http_client` (avg coverage 73.0%) | can handle arxiv abs url; can handle arxiv pdf url with www; cannot handle non arxiv domain; preprocess converts abs to pdf; preprocess normalizes pdf host; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_hackernews_strategy.py` | contract-or-unit | `app.processing_strategies.hackernews_strategy`, `app.http_client.robust_http_client` (avg coverage 80.0%) | can handle hn item url; cannot handle non hn urls; clean html text; extract data link post; extract data text post; +8 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_html_strategy.py` | unit | `app.processing_strategies.html_strategy`, `app.http_client.robust_http_client` (avg coverage 78.8%) | can handle url html content type; can handle url no headers html pattern; can handle url no headers other pattern; can handle url other content type; detect source; +15 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_html_strategy_event_loop.py` | unit | `app.processing_strategies.html_strategy` (avg coverage 77.1%) | html strategy async extract data; html strategy concurrent extractions; html strategy error handling; html strategy with different sources | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_html_strategy_gate_detection.py` | unit | `app.processing_strategies.html_strategy` (avg coverage 77.1%) | detect access gate from javascript notice; detect access gate ignores normal article content | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/processing_strategies/test_html_strategy_overrides.py` | unit | `app.processing_strategies.html_strategy`, `app.core.settings` (avg coverage 86.0%) | domain override sets no wait for | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/processing_strategies/test_image_strategy.py` | unit | `app.processing_strategies.image_strategy`, `app.http_client.robust_http_client` (avg coverage 89.1%) | can handle url by content type; can handle url by extension; can handle url by format parameter; cannot handle non image content type; cannot handle non image urls; +5 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_pdf_strategy.py` | unit | `app.processing_strategies.pdf_strategy`, `app.http_client.robust_http_client` (avg coverage 83.2%) | can handle url excludes arxiv; can handle url non pdf; can handle url pdf content type; can handle url pdf extension; download content; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_pubmed_strategy.py` | unit | `app.processing_strategies.pubmed_strategy`, `app.http_client.robust_http_client` (avg coverage 83.6%) | can handle url; download content; extract data first link used; extract data malformed html; extract data no links found; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_strategy_outputs.py` | unit | `app.processing_strategies.pubmed_strategy`, `app.processing_strategies.hackernews_strategy` (avg coverage 88.0%) | arxiv strategy extract data sets text content; hackernews extract data contains text; image strategy marks skip processing; pdf strategy extract data sets text content; pubmed strategy returns delegation; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/processing_strategies/test_youtube_strategy.py` | contract-or-unit | `app.processing_strategies.youtube_strategy`, `app.scraping.youtube_unified` (avg coverage 64.1%) | build extractor args with po token provider; build extractor args without provider; can handle url patterns; extract data falls back to title when no text content; extract data raises when video info missing; +2 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/api/test_chat_models.py` | api-integration | `app.routers.api.chat_models` (avg coverage 100.0%) | chat message role includes tool | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/api/test_content_detail.py` | api-integration | `app.routers.api.content_detail` (avg coverage 69.9%) | chat url includes user prompt; chat url without user prompt | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/routers/api/test_content_detail_subscribe.py` | api-integration | `app.constants`, `app.models.metadata` (avg coverage 88.6%) | can subscribe false for non news non self submission; can subscribe false when already subscribed; can subscribe self submission true when missing config; can subscribe true for news content | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/api/test_content_discussion.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | get content discussion returns 404 when missing content; get content discussion returns comments payload; get content discussion returns discussion list payload; get content discussion returns not ready when missing | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/api/test_content_stats.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 92.6%) | long form stats counts; processing count includes news and new status; unread counts require inbox for news | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_admin.py` | api-integration | `app.routers.admin`, `app.core.deps` (avg coverage 84.0%) | admin dashboard filters event logs by type; admin dashboard renders sections | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_admin_conversational.py` | api-integration | `app.routers.admin`, `app.core.deps` (avg coverage 86.4%) | admin conversational health requires admin session; admin conversational health returns flags; admin conversational page requires admin session; admin conversational ws rejects missing admin cookie; admin conversational ws streams turn events | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_admin_dashboard_readouts.py` | api-integration | `app.core.deps`, `app.models.schema` (avg coverage 91.7%) | admin dashboard shows operational readouts | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_admin_eval.py` | api-integration | `app.routers.admin`, `app.core.deps` (avg coverage 82.7%) | admin eval page requires admin session; admin eval run rejects unknown model; admin eval run requires admin session; admin eval run returns payload | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_admin_onboarding_lane_preview.py` | api-integration | `app.routers.admin`, `app.routers.api.models` (avg coverage 85.4%) | admin onboarding lane preview api requires admin session; admin onboarding lane preview api returns plan; admin onboarding lane preview page requires admin session | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_bulk_mark_read.py` | api-integration | `app.models.schema` (avg coverage 92.7%) | bulk mark read endpoint handles invalid ids; bulk mark read endpoint success | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_api_chat.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | create chat session content not found; create chat session with content; create chat session with topic; create chat session without content; delete chat session archives session; +8 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_convert.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | convert already exists; convert news link no article url; convert news link to article; convert non news content | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_download_more.py` | api-integration | `app.routers.api`, `app.models.schema` (avg coverage 75.3%) | download more from series success | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_interactions.py` | api-integration | `app.models.schema`, `app.main` (avg coverage 90.8%) | record content interaction idempotent; record content interaction missing content; record content interaction requires authentication; record content interaction success | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_list.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 86.0%) | list filters articles without keypoints or image; list hides news images even when metadata has urls | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_pagination.py` | api-integration | `app.utils.pagination`, `app.models.metadata` (avg coverage 91.8%) | cursor with filters; custom limit; decode invalid cursor; empty favorites; encode decode cursor; +14 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_submission.py` | api-integration | `app.constants`, `app.models.metadata` (avg coverage 88.6%) | duplicate submission reuses existing record; reject invalid scheme; share and chat existing completed enqueues dig deeper task; submit accepts instruction alias; submit share and chat marks read and tracks user; +4 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_content_visibility.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 89.0%) | api excludes inbox content not completed; api excludes unprocessed news | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_discovery.py` | api-integration | `app.routers.api`, `app.routers.api.discovery` (avg coverage 86.7%) | discovery add item creates content; discovery dismiss marks suggestion; discovery history groups runs; discovery podcast search returns results; discovery subscribe creates config; +2 more | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/routers/test_api_integrations.py` | api-integration | `app.routers.api`, `app.routers.api.integrations` (avg coverage 91.9%) | disconnect x connection clears tokens; exchange x oauth returns connection; get x connection default state; start x oauth returns authorize url | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_api_recently_read.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 92.6%) | recently read scoped to user | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_submission_status_list.py` | api-integration | `app.models.metadata`, `app.models.schema` (avg coverage 92.6%) | submission status list filters by user and status | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_api_tweet_suggestions.py` | api-integration | `app.routers.api`, `app.routers.api.content_actions` (avg coverage 85.9%) | tweet suggestions content not completed; tweet suggestions content not found; tweet suggestions creativity out of range; tweet suggestions default creativity; tweet suggestions llm failure; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_api_voice.py` | api-integration | `app.routers.api`, `app.routers.api.voice` (avg coverage 92.4%) | create voice session; create voice session allows dictate summary for article; voice health returns flags; voice websocket acknowledges response cancel for active turn; voice websocket acknowledges response cancel without active turn; +10 more | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/routers/test_auth.py` | api-integration | `app.routers.auth`, `app.core.db` (avg coverage 88.6%) | admin login invalid; admin login valid; admin logout; apple signin existing user; apple signin invalid token; +15 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_content.py` | api-integration | `app.main` (avg coverage 88.9%) | admin dashboard requires admin session; removed web content routes return 404; root redirects to admin | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/routers/test_logs.py` | api-integration | `app.routers.logs`, `app.routers` (avg coverage 56.0%) | get recent structured events empty dir; get recent structured events reads latest entries | Function-oriented module (no primary class under test) | Improve: expand branch/error-path coverage for target module |
| `tests/routers/test_onboarding.py` | api-integration | `app.services.onboarding`, `app.routers.api.onboarding` (avg coverage 84.8%) | onboarding audio discover creates run; onboarding complete creates configs; onboarding complete rejects invalid twitter username; onboarding complete seeds news; onboarding discovery status returns suggestions; +5 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/routers/test_openai.py` | api-integration | `app.services.openai_realtime` (avg coverage 25.6%) | realtime token endpoint | Function-oriented module (no primary class under test) | Improve: expand branch/error-path coverage for target module |
| `tests/routers/test_scraper_configs.py` | api-integration | `app.constants`, `app.models.schema` (avg coverage 90.3%) | scraper config limit validation; scraper config reddit; scraper configs crud; scraper configs filtering and limits; subscribe feed defaults limit | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/routers/test_submission_content_status.py` | api-integration | `app.models.schema` (avg coverage 92.7%) | submission creates content status | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/schemas/test_metadata.py` | unit | `app.models.metadata` (avg coverage 85.2%) | article with string summary; article with structured summary; content type validation; long quotes allowed; maximum limits; +10 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/scraping/test_config_loaders.py` | unit | `app.scraping.podcast_unified`, `app.scraping.substack_unified` (avg coverage 75.9%) | podcast no feeds configured; reddit config env override; substack env override success; substack missing config logs once | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/scraping/test_hackernews_unified.py` | contract-or-unit | `app.scraping.hackernews_unified`, `app.models.metadata` (avg coverage 83.4%) | hackernews scraper creates article | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/scraping/test_paths_config.py` | unit | `app.utils.paths` (avg coverage 89.1%) | resolve config directory env override; resolve config path absolute; resolve config path default when missing; resolve config path relative cwd; resolve config path uses config dir | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/scraping/test_podcast_audio_extraction.py` | contract-or-unit | `app.scraping.podcast_unified`, `app.pipeline.podcast_workers` (avg coverage 73.6%) | extract anchor redirect url; extract normal url; find audio enclosure by extension; find audio enclosure from enclosures; find audio enclosure from links; +9 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/scraping/test_podcast_rss_scraper.py` | contract-or-unit | `app.scraping.base`, `app.scraping.podcast_unified` (avg coverage 76.4%) | existing podcast entries are skipped | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/scraping/test_podcast_scraper_integration.py` | contract-or-unit | `app.scraping.podcast_unified`, `app.scraping.base` (avg coverage 73.3%) | podcast feed parsing edge cases; podcast scraper creates correct content; podcast scraper skips existing urls; process content queues download audio | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/scraping/test_podcast_unified.py` | contract-or-unit | `app.scraping.podcast_unified` (avg coverage 75.1%) | podcast fallback accepts enclosure without type; podcast fallback uses alternate link when link missing; podcast fallback uses enclosure when link missing | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/scraping/test_reddit_unified.py` | contract-or-unit | `app.scraping.reddit_unified`, `app.scraping` (avg coverage 84.3%) | is external url allows front media; reddit scraper uses praw | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/scraping/test_substack_scraper.py` | contract-or-unit | `app.scraping.substack_unified`, `app.scraping.base` (avg coverage 79.4%) | load substack feeds; load substack feeds with limit; no feeds configured; run saves to database; run skips existing urls; +6 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/scraping/test_techmeme_scraper.py` | contract-or-unit | `app.scraping.techmeme_unified` (avg coverage 88.4%) | load techmeme config defaults; scrape returns primary and related; scrape skips entries without article | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/scraping/test_twitter_unified.py` | contract-or-unit | `app.scraping.twitter_unified` (avg coverage 55.2%) | build headers activates guest token; decode response json logs 404 empty body; decode response json logs transient 429; decode response json returns payload; decode response json skips abs asset logs; +8 more | Direct class-level coverage present | Improve: expand branch/error-path coverage for target module |
| `tests/scraping/test_youtube_unified.py` | contract-or-unit | `app.scraping.youtube_unified` (avg coverage 70.6%) | client config resolution; load youtube channels; load youtube client config; missing config returns empty; scrape respects max age; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_admin_conversational_agent.py` | unit | `app.services.admin_conversational_agent`, `app.core.settings` (avg coverage 87.9%) | append turn trims history to setting; build available knowledge context lists favorites; create or get session state rejects mismatched user; create or get session state reuses existing; search knowledge returns only matching favorites; +4 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_admin_eval.py` | unit | `app.services.admin_eval`, `app.models.schema` (avg coverage 86.5%) | run admin eval disables model after first hard error; run admin eval skips unavailable models; run admin eval uses news title focus and cost; select eval samples is deterministic; select eval samples uses total budget across types | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_chat_agent.py` | unit | `app.services.chat_agent`, `app.models.metadata` (avg coverage 70.4%) | build article context falls back to summary when budget exceeded; build article context includes full transcript with budget; build article context prefers summary over full text when requested | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_content_analyzer.py` | unit | `app.services.content_analyzer`, `app.services.content_submission` (avg coverage 73.8%) | analyze url fetch failure still uses llm; analyze url with spotify link; apple podcasts detected as podcast; article result; explicit type returned; +14 more | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_content_interactions.py` | unit | `app.services.content_interactions`, `app.models.schema` (avg coverage 89.7%) | record content interaction idempotent for same user; record content interaction raises for missing content; record content interaction same interaction id for different users; record content interaction success | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_dig_deeper.py` | unit | `app.services.dig_deeper`, `app.models.metadata` (avg coverage 82.5%) | build dig deeper prompt includes discussion comment context; build dig deeper prompt includes discussion group topics; build dig deeper prompt without discussion context | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_discussion_fetcher.py` | unit | `app.services.discussion_fetcher`, `app.models.metadata` (avg coverage 84.3%) | backward compatible without url titles; bluesky; body html titles flow through; build reddit payload marks http 403 as non retryable; build reddit payload uses authenticated reddit client; +36 more | Module has classes, tests hit module/API behavior more than class internals | Improve: split into smaller focused test modules |
| `tests/services/test_favorites.py` | unit | `app.services.favorites`, `app.models.schema` (avg coverage 89.6%) | add favorite already exists; add favorite success; clear favorites empty; clear favorites success; clear favorites user isolation; +14 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_feed_detection.py` | unit | `app.services.feed_detection`, `app.services` (avg coverage 73.2%) | build candidate feed urls includes root and section; extract feed links from anchors resolves relative url; validate feed candidate parses rss | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_feed_discovery.py` | unit | `app.services.feed_discovery`, `app.models.feed_discovery` (avg coverage 66.7%) | run feed discovery creates run and suggestions | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/services/test_feed_discovery_apple_podcasts.py` | contract-or-unit | `app.models.feed_discovery`, `app.services` (avg coverage 100.0%) | extract apple podcast id; normalize candidate resolves apple podcast feed | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_feed_discovery_optimizations.py` | unit | `app.models.feed_discovery`, `app.services` (avg coverage 100.0%) | domain attempt cap limits validation; sanitize candidate url removes markdown; skip candidate on known host | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_feed_subscription.py` | unit | `app.services.feed_subscription`, `app.constants` (avg coverage 84.8%) | subscribe to detected feed creates config | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/services/test_gateways.py` | unit | `app.services.gateways`, `app.services.gateways.http_gateway` (avg coverage 100.0%) | get http gateway returns cached instance; get llm gateway returns cached instance; get task queue gateway returns cached instance; http gateway forwards calls and close; llm gateway proxies analyze and summarize; +2 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_instruction_links.py` | unit | `app.services.instruction_links`, `app.services.content_analyzer` (avg coverage 77.3%) | create contents from instruction links creates new; create contents from instruction links skips existing | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/services/test_langfuse_tracing.py` | contract-or-unit | `app.services.langfuse_tracing`, `app.services` (avg coverage 87.6%) | extract google usage details; extract google usage details preserves zero counts; flush langfuse tracing calls client flush; initialize langfuse tracing disabled; initialize langfuse tracing does not retry after missing keys; +5 more | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/services/test_llm_agents.py` | unit | `app.services.llm_agents`, `app.services` (avg coverage 75.0%) | get basic agent returns fresh agent instances | Function-oriented module (no primary class under test) | Improve: add edge-case assertions |
| `tests/services/test_llm_models.py` | unit | `app.services.llm_models`, `app.services` (avg coverage 90.2%) | build pydantic model anthropic; build pydantic model google; build pydantic model google gemini3; build pydantic model openai | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_llm_summarization.py` | unit | `app.services.llm_summarization`, `app.models.metadata` (avg coverage 90.6%) | content summarizer resolves default models; content summarizer respects overrides; summarize content retries on context length error; summarize content truncates long payload; summarize content uses agent; +1 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_llm_summarization_fallbacks.py` | unit | `app.services.llm_summarization`, `app.services` (avg coverage 93.3%) | summarize content falls back cross provider on precondition error; summarize content recovers from event loop binding error; summarize content returns none when openai fallback is unconfigured; summarize content uses context fallback model | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_onboarding_audio_plan.py` | unit | `app.services.onboarding` (avg coverage 73.1%) | audio lane plan fallback queries keep reddit focus; audio lane plan preserves reddit lane when full; audio lane plan refines queries to sentence style | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_onboarding_discovery_rationale.py` | unit | `app.services.onboarding`, `app.services.exa_client` (avg coverage 70.5%) | build discovery response backfills merged rationale; fast discover defaults backfills rationale; format discovery prompt includes curated fill ins | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_onboarding_exa_parallel_and_feed_cap.py` | unit | `app.services.onboarding`, `app.services.exa_client` (avg coverage 70.5%) | build discovery response caps feed suggestions to ten; fast discover defaults caps feed suggestions to ten; run discovery exa queries uses query metadata | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_onboarding_feed_likelihood.py` | unit | `app.services.onboarding` (avg coverage 73.1%) | normalize suggestions uses candidate feed url when feed url missing; normalize suggestions uses likely feed site when feed like | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/services/test_onboarding_model_fallback.py` | unit | `app.services.onboarding` (avg coverage 73.1%) | audio plan fallback uses secondary model; default onboarding fallback order; discover fallback uses secondary model | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_onboarding_persistence.py` | unit | `app.services.onboarding`, `app.models.schema` (avg coverage 87.6%) | persist discovery run deduplicates within response; persist discovery run returns none when all feeds already exist | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/services/test_onboarding_prompt_selection.py` | unit | `app.services.onboarding` (avg coverage 73.1%) | select prompt results balances lanes; select prompt results dedupes urls | Direct class-level coverage present | Improve: add edge-case assertions |
| `tests/services/test_openai_realtime.py` | contract-or-unit | `app.services.openai_realtime`, `app.services` (avg coverage 62.8%) | build transcription session config defaults; build transcription session config with locale | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
| `tests/services/test_openai_transcription.py` | contract-or-unit | `app.services.openai_llm` (avg coverage 66.1%) | check ffmpeg available; check file size; get audio duration; get audio format; get transcription prompt; +4 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_podcast_search.py` | contract-or-unit | `app.services.podcast_search`, `app.services` (avg coverage 67.7%) | search podcast episodes merges and dedupes; search podcast episodes short query returns empty | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_prompt_debug_report.py` | unit | `app.services.prompt_debug_report`, `app.models.schema` (avg coverage 79.2%) | reconstruct analyze url prompt partial; reconstruct summarize prompt from content metadata; render markdown report contains failure sections; select failure records filters by component and window; select failure records supports explicit since until | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_queue.py` | unit | `app.services.queue`, `app.models.schema` (avg coverage 93.3%) | cleanup old tasks; complete task failure; complete task not found; complete task success; dequeue task empty queue; +14 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_queue_service.py` | unit | `app.services.queue`, `app.models.schema` (avg coverage 93.3%) | complete task sets default error message; dequeue filters by queue name; dequeue respects retry delay schedule; dequeue rotates retry buckets; enqueue assigns default queue by task type; +3 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_read_status.py` | unit | `app.services.read_status`, `app.models.schema` (avg coverage 87.4%) | clear read status empty; clear read status success; clear read status user isolation; content; content 2; +15 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_scraper_config_service.py` | unit | `app.services.scraper_configs` (avg coverage 76.8%) | build feed payloads apply default limit; create and list config; create youtube config accepts channel id; list filtered by type; uniqueness enforced | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_scraper_configs.py` | unit | `app.services.scraper_configs`, `app.models.metadata` (avg coverage 84.9%) | ensure inbox status allows news | Module has classes, tests hit module/API behavior more than class internals | Improve: add edge-case assertions |
| `tests/services/test_tweet_suggestions.py` | unit | `app.services.tweet_suggestions`, `app.services.llm_prompts` (avg coverage 78.3%) | creativity to style hints high; creativity to style hints low; creativity to style hints mid; creativity to temperature clamped; creativity to temperature high; +31 more | Direct class-level coverage present | Improve: split into smaller focused test modules |
| `tests/services/test_twitter_share.py` | contract-or-unit | `app.services.twitter_share`, `app.services` (avg coverage 79.2%) | fetch tweet detail parses thread; tweet url helpers | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_voice_agent_streaming.py` | unit | `app.services.voice`, `app.services.voice.agent_streaming` (avg coverage 69.5%) | build turn instructions prefers knowledge for personal saved queries; build turn instructions prefers web for recent general queries; build turn instructions skips small talk; knowledge route wins over web route when both present | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_voice_elevenlabs_streaming.py` | contract-or-unit | `app.services.voice`, `app.services.voice.elevenlabs_streaming` (avg coverage 80.0%) | build realtime tts stream sets voice settings none; open realtime stt connection omits blank language code; open realtime stt connection reads text payload | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_voice_orchestrator.py` | unit | `app.services.voice.orchestrator`, `app.services.voice` (avg coverage 66.1%) | commit and collect transcript ignores stale finals; process intro turn emits turn cancelled on cancellation; raise pending stt errors ignores commit too soon error; raise pending stt errors raises for non recoverable error | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/services/test_voice_session_manager.py` | unit | `app.services.voice.session_manager` (avg coverage 90.2%) | append and read message history; configure voice session sets launch metadata; create and get voice session; get voice session rejects other user; prune voice sessions removes expired entries | Module has classes, tests hit module/API behavior more than class internals | Keep as-is; optional cleanup only |
| `tests/services/test_x_api.py` | contract-or-unit | `app.services.x_api` (avg coverage 27.9%) | normalize external url filters x twitter domains; normalize external url keeps non social domains | Module has classes, tests hit module/API behavior more than class internals | Improve: expand branch/error-path coverage for target module |
| `tests/test_atom_scraper.py` | unit | `app.scraping.atom_unified`, `app.scraping.runner` (avg coverage 56.2%) | atom scraper in runner; load atom feeds missing file; load atom feeds string format; load atom feeds valid config | Direct class-level coverage present | Improve: expand branch/error-path coverage for target module |
| `tests/test_fixtures_example.py` | unit | `app.models.schema`, `app.main` (avg coverage 90.8%) | all fixtures have required fields; content metadata structure; create content in db; load article fixture; load podcast fixture; +3 more | Direct class-level coverage present | Keep as-is; optional cleanup only |
| `tests/utils/test_summary_metadata.py` | unit | `app.utils.summary_metadata`, `app.constants` (avg coverage 85.8%) | infer summary kind version bullets; infer summary kind version editorial narrative; infer summary kind version interleaved v1; infer summary kind version interleaved v2; infer summary kind version news content type defaults; +3 more | Function-oriented module (no primary class under test) | Keep as-is; optional cleanup only |
