"""Generate Swift enum contracts from backend canonical enums."""

from __future__ import annotations

import argparse
from pathlib import Path

from app.models.contracts import (
    ContentClassification,
    ContentStatus,
    ContentType,
    SummaryKind,
    SummaryVersion,
    TaskStatus,
    TaskType,
)

HEADER = """// swiftlint:disable all
// Generated by scripts/generate_ios_contracts.py. Do not edit manually.
import Foundation

"""


def _swift_enum(name: str, values: list[str], *, codable: bool = True) -> str:
    protocols = ["String"]
    if codable:
        protocols.extend(["Codable", "CaseIterable"])
    protocol_list = ", ".join(protocols)
    lines = [f"enum {name}: {protocol_list} {{"]
    for value in values:
        case_name = value.replace("-", "_")
        lines.append(f'    case {case_name} = "{value}"')
    lines.append("}")
    lines.append("")
    return "\n".join(lines)


def _swift_int_enum(name: str, values: list[int]) -> str:
    lines = [f"enum {name}: Int, Codable, CaseIterable {{"]
    for value in values:
        lines.append(f"    case v{value} = {value}")
    lines.append("}")
    lines.append("")
    return "\n".join(lines)


def build_swift_contracts() -> str:
    """Build generated Swift source."""
    sections = [
        HEADER,
        _swift_enum("APIContentType", [item.value for item in ContentType]),
        _swift_enum("APIContentStatus", [item.value for item in ContentStatus]),
        _swift_enum("APIContentClassification", [item.value for item in ContentClassification]),
        _swift_enum("APITaskType", [item.value for item in TaskType]),
        _swift_enum("APITaskStatus", [item.value for item in TaskStatus]),
        _swift_enum("APISummaryKind", [item.value for item in SummaryKind]),
        _swift_int_enum("APISummaryVersion", [item.value for item in SummaryVersion]),
    ]
    return "\n".join(sections).rstrip() + "\n"


def parse_args() -> argparse.Namespace:
    """Parse script arguments."""
    parser = argparse.ArgumentParser(description="Generate iOS API enum contracts")
    parser.add_argument(
        "--output",
        default="client/newsly/newsly/Models/Generated/APIContracts.generated.swift",
        help="Output Swift file path",
    )
    return parser.parse_args()


def main() -> int:
    """CLI entrypoint."""
    args = parse_args()
    output = Path(args.output)
    output.parent.mkdir(parents=True, exist_ok=True)
    output.write_text(build_swift_contracts(), encoding="utf-8")
    print(f"Generated Swift contracts: {output}")
    return 0


if __name__ == "__main__":
    raise SystemExit(main())

