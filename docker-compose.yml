services:
  # FastAPI server
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: news-app-server
    ports:
      - "8000:8000"
    volumes:
      - ./data:/data
      - ./logs:/logs
      - ./logs:/app/logs
    env_file: .env.docker
    depends_on:
      - scrapers
    restart: unless-stopped
    networks:
      - news-app-network

  # Task processing workers
  workers:
    build:
      context: .
      dockerfile: Dockerfile.workers
    container_name: news-app-workers
    volumes:
      - ./data:/data
      - ./logs:/logs
      - ./logs:/app/logs
    env_file: .env.docker
    depends_on:
      - server
    restart: unless-stopped
    networks:
      - news-app-network

  # Content scrapers with cron
  scrapers:
    build:
      context: .
      dockerfile: Dockerfile.scrapers
    container_name: news-app-scrapers
    volumes:
      - ./data:/data
      - ./logs:/logs
      - ./logs:/app/logs
    env_file: .env.docker
    environment:
      - SCRAPER_CRON_SCHEDULE=${SCRAPER_CRON_SCHEDULE:-0 */4 * * *}
      - SCRAPER_RUN_ON_START=${SCRAPER_RUN_ON_START:-true}
    restart: unless-stopped
    networks:
      - news-app-network

networks:
  news-app-network:
    driver: bridge

volumes:
  data:
  logs:
