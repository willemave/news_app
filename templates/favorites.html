{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
      <span class="text-yellow-500">⭐</span> Favorites
    </h1>
  </div>

  <!-- Filters Section -->
  <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
    <form method="get" action="/favorites" class="flex flex-wrap gap-4 items-end">
      <div class="flex-1 min-w-[200px]">
        <label for="read_filter" class="block text-sm font-medium text-gray-700 mb-1">
          Read Status
        </label>
        <select name="read_filter" id="read_filter" 
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="this.form.submit()">
          <option value="all" {% if selected_read_filter == 'all' %}selected{% endif %}>All</option>
          <option value="unread" {% if selected_read_filter == 'unread' %}selected{% endif %}>Unread Only</option>
          <option value="read" {% if selected_read_filter == 'read' %}selected{% endif %}>Read Only</option>
        </select>
      </div>
    </form>
  </div>

  <!-- Content List -->
  <div class="space-y-4">
    {% if not contents %}
      <div class="bg-white rounded-lg shadow-sm p-8 text-center">
        <div class="text-6xl mb-4">⭐</div>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">No favorites yet</h2>
        <p class="text-gray-500">Content you favorite will appear here.</p>
        <p class="text-gray-500">Click the star icon on any article or podcast to add it to your favorites.</p>
      </div>
    {% else %}
      {% for content in contents %}
        <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow {% if content.id in read_content_ids %}opacity-75{% endif %}">
          <div class="flex items-start justify-between mb-2">
            <div class="flex-1">
              <h2 class="text-lg font-semibold">
                <a href="/content/{{ content.id }}" class="{% if content.id in read_content_ids %}text-gray-600{% else %}text-gray-900{% endif %} hover:text-blue-600 transition-colors">
                  {{ content.display_title }}
                </a>
                {% if content.id in read_content_ids %}
                  <span class="text-xs text-gray-500 font-normal">(read)</span>
                {% endif %}
              </h2>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="toggleFavorite({{ content.id }})" 
                      class="text-xl hover:scale-110 transition-transform"
                      title="Remove from favorites">
                ⭐
              </button>
              <span class="px-2 py-1 text-xs font-medium rounded-full 
                           {% if content.content_type.value == 'article' %}bg-blue-100 text-blue-800
                           {% elif content.content_type.value == 'podcast' %}bg-purple-100 text-purple-800
                           {% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ content.content_type.value.replace('_', ' ').title() }}
              </span>
            </div>
          </div>
          
          <div class="text-sm text-gray-600 mb-2">
            <time datetime="{{ content.publication_date or content.created_at }}">
              {{ (content.publication_date or content.created_at).strftime('%B %d, %Y at %I:%M %p') if (content.publication_date or content.created_at) else 'Date unknown' }}
            </time>
            {% if content.source %}
              <span class="mx-1">•</span>
              <span>{{ content.source }}</span>
            {% endif %}
          </div>
          
          {% if content.short_summary %}
            <p class="text-gray-700">{{ content.short_summary }}</p>
          {% else %}
            <p class="text-gray-500 italic">No summary available</p>
          {% endif %}
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<script>
async function toggleFavorite(contentId) {
    try {
        const response = await fetch(`/api/content/${contentId}/favorite`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            // Reload the page to update the list
            window.location.reload();
        } else {
            console.error('Failed to toggle favorite');
        }
    } catch (error) {
        console.error('Error toggling favorite:', error);
    }
}
</script>
{% endblock %}