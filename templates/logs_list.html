{% extends "base.html" %}
{% block title %}System Logs{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-3">
    <div>
      <h1 class="text-xl font-semibold text-gray-900">System Logs</h1>
      <p class="text-sm text-gray-500 mt-0.5">Error log files from <code class="text-xs bg-gray-100 px-1 py-0.5 rounded">logs/errors/</code></p>
    </div>
    <a href="/admin/errors" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors self-start">
      Error Analysis
    </a>
  </div>

  <!-- Recent Errors -->
  {% if recent_errors %}
  <div class="bg-white rounded-lg border border-red-200 mb-4">
    <details open>
      <summary class="px-4 py-3 border-b border-red-100 bg-red-50/30 cursor-pointer select-none flex items-center justify-between hover:bg-red-50/50 transition-colors">
        <div class="flex items-center gap-2">
          <h2 class="text-sm font-semibold text-red-800">Recent Errors</h2>
          <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-semibold bg-red-100 text-red-700">{{ recent_errors|length }}</span>
        </div>
        <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
      </summary>
      <div class="divide-y divide-red-100">
        {% for error in recent_errors %}
        <div class="px-4 py-3 hover:bg-red-50/20 transition-colors">
          <div class="flex items-start justify-between gap-4">
            <div class="min-w-0 flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-red-100 text-red-700">{{ error.source }}</span>
                <span class="text-[11px] text-gray-400 tabular-nums">{{ error.timestamp }}</span>
              </div>
              <p class="text-xs text-gray-700 leading-relaxed">{{ error.message }}</p>
            </div>
            <a href="/admin/logs/errors/{{ error.file }}" class="flex-shrink-0 text-[11px] text-blue-600 hover:text-blue-800 hover:underline whitespace-nowrap">View file</a>
          </div>
        </div>
        {% endfor %}
      </div>
    </details>
  </div>
  {% endif %}

  <!-- Log Files Table -->
  <div class="bg-white rounded-lg border border-gray-200">
    <div class="px-4 py-3 border-b border-gray-100">
      <h2 class="text-sm font-semibold text-gray-900">All Log Files</h2>
    </div>
    {% if log_files %}
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="border-b border-gray-100">
            <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filename</th>
            <th class="px-4 py-2.5 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
            <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modified</th>
            <th class="px-4 py-2.5 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
          {% for log in log_files %}
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-4 py-2.5">
              <a href="/admin/logs/{{ log.filename }}" class="text-sm text-blue-600 hover:text-blue-800 hover:underline font-medium font-mono">{{ log.filename }}</a>
            </td>
            <td class="px-4 py-2.5 text-right text-xs text-gray-500 tabular-nums">{{ log.size }}</td>
            <td class="px-4 py-2.5 text-xs text-gray-500">{{ log.modified }}</td>
            <td class="px-4 py-2.5 text-right">
              <a href="/admin/logs/{{ log.filename }}/download" class="inline-flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                Download
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="px-4 py-12 text-center text-sm text-gray-400">No log files found.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
