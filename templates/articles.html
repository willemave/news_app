{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Minimal Header -->
  <div class="mb-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h1 class="text-xl font-medium text-gray-900">
          Articles{% if current_source %} · <span class="text-blue-600">{{ current_source|title }}</span>{% endif %}{% if current_date %} · <span class="text-blue-600">{{ current_date }}</span>{% endif %}
        </h1>
        <p class="mt-1 text-sm text-gray-500">{{ articles|length if articles else 0 }} article{{ 's' if articles|length != 1 else '' }}</p>
      </div>
      <div class="flex items-center">
        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
          {{ articles|length if articles else 0 }}
        </span>
      </div>
    </div>
  </div>

  <!-- Minimal Filter Controls -->
  <div class="mb-6 p-4 bg-gray-50 rounded-lg">
    <div class="flex flex-col sm:flex-row sm:items-center gap-4">
      <!-- Date Filter -->
      <div class="flex items-center gap-2">
        <label for="date-filter" class="text-sm text-gray-600 whitespace-nowrap">Date:</label>
        <select id="date-filter" class="px-3 py-1 border-0 bg-white rounded-md text-sm focus:ring-1 focus:ring-blue-500 transition-all min-w-[120px]" onchange="filterByDate(this.value)">
          <option value="">All</option>
          {% if available_dates %}
            {% for date in available_dates %}
              <option value="{{ date }}" {% if current_date == date %}selected{% endif %}>
                {{ date }}
              </option>
            {% endfor %}
          {% endif %}
        </select>
      </div>

      <!-- Source Filter -->
      <div class="flex items-center gap-2">
        <span class="text-sm text-gray-600 whitespace-nowrap">Source:</span>
        <div class="flex flex-wrap gap-1">
          <a href="/articles/{% if current_date %}?date={{ current_date }}{% endif %}" class="px-2 py-1 rounded text-xs font-medium transition-all {% if not current_source %}bg-blue-600 text-white{% else %}bg-white text-gray-600 hover:bg-gray-100{% endif %}">All</a>
          <a href="/articles/?source=reddit{% if current_date %}&date={{ current_date }}{% endif %}" class="px-2 py-1 rounded text-xs font-medium transition-all {% if current_source == 'reddit' %}bg-blue-600 text-white{% else %}bg-white text-gray-600 hover:bg-gray-100{% endif %}">Reddit</a>
          <a href="/articles/?source=hackernews{% if current_date %}&date={{ current_date }}{% endif %}" class="px-2 py-1 rounded text-xs font-medium transition-all {% if current_source == 'hackernews' %}bg-blue-600 text-white{% else %}bg-white text-gray-600 hover:bg-gray-100{% endif %}">HackerNews</a>
          <a href="/articles/?source=unknown{% if current_date %}&date={{ current_date }}{% endif %}" class="px-2 py-1 rounded text-xs font-medium transition-all {% if current_source == 'unknown' %}bg-blue-600 text-white{% else %}bg-white text-gray-600 hover:bg-gray-100{% endif %}">Unknown</a>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex items-center gap-2 sm:ml-auto">
        {% if current_source or current_date %}
          <a href="/articles/" class="inline-flex items-center px-3 py-1 bg-gray-600 text-white text-xs font-medium rounded hover:bg-gray-700 transition-colors">
            Clear
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Modern Minimal Articles Table -->
  {% if articles %}
  <div class="bg-white rounded-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-100">
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 w-24">Date</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 w-20">Source</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 min-w-[200px]">Title</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 hidden lg:table-cell">Summary</th>
            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 w-20">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for article in articles %}
            <tr class="hover:bg-gray-25 transition-colors group">
              <!-- Date Column -->
              <td class="px-4 py-3 text-xs text-gray-500 font-mono">
                {{ article.scraped_date.strftime('%m-%d') if article.scraped_date else '--' }}
              </td>
              
              <!-- Source Column -->
              <td class="px-4 py-3">
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium
                  {% if article.link.source|lower == 'reddit' %}bg-orange-50 text-orange-700
                  {% elif article.link.source|lower == 'hackernews' %}bg-orange-50 text-orange-600
                  {% else %}bg-gray-50 text-gray-600{% endif %}">
                  {% if article.link.source|lower == 'reddit' %}
                    R
                  {% elif article.link.source|lower == 'hackernews' %}
                    HN
                  {% else %}
                    {{ article.link.source[:2]|upper }}
                  {% endif %}
                </span>
              </td>

              <!-- Title Column -->
              <td class="px-4 py-3">
                <div class="space-y-1">
                  <a href="/articles/detail/{{ article.id }}" class="block text-sm text-gray-900 hover:text-blue-600 transition-colors line-clamp-2">
                    {{ article.title if article.title else article.url }}
                  </a>
                  {% if article.url and article.title %}
                    <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-xs text-gray-400 hover:text-blue-500 transition-colors">
                      {{ article.url.split('/')[2] if '/' in article.url else article.url[:25] }}
                    </a>
                  {% endif %}
                  <!-- Mobile Summary -->
                  {% if article.short_summary %}
                    <p class="text-xs text-gray-500 line-clamp-2 lg:hidden mt-1">{{ article.short_summary }}</p>
                  {% endif %}
                </div>
              </td>

              <!-- Summary Column (Hidden on mobile) -->
              <td class="px-4 py-3 hidden lg:table-cell">
                {% if article.short_summary %}
                  <p class="text-xs text-gray-600 line-clamp-2">{{ article.short_summary }}</p>
                {% else %}
                  <span class="text-xs text-gray-300">—</span>
                {% endif %}
              </td>

              <!-- Actions Column -->
              <td class="px-4 py-3">
                <div class="flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                  <a href="/articles/detail/{{ article.id }}" class="inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:bg-blue-50 rounded transition-colors text-xs" title="View">
                    ↗
                  </a>
                  {% if article.url %}
                    <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-6 h-6 text-gray-500 hover:bg-gray-50 rounded transition-colors text-xs" title="Source">
                      ⧉
                    </a>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% else %}
    <!-- Minimal Empty State -->
    <div class="text-center py-12 px-6">
      <div class="w-12 h-12 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4">
        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No articles found</h3>
      <p class="text-gray-500 mb-6 text-sm">
        {% if current_source and current_date %}
          No articles for {{ current_source|title }} on {{ current_date }}.
        {% elif current_source %}
          No articles for {{ current_source|title }}.
        {% elif current_date %}
          No articles for {{ current_date }}.
        {% else %}
          No articles available.
        {% endif %}
      </p>
      {% if current_source or current_date %}
        <a href="/articles/" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition-colors">
          View All Articles
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>

<script>
function filterByDate(selectedDate) {
  const currentUrl = new URL(window.location);
  const params = new URLSearchParams(currentUrl.search);
  
  if (selectedDate) {
    params.set('date', selectedDate);
  } else {
    params.delete('date');
  }
  
  // Preserve existing source filter
  const newUrl = currentUrl.pathname + '?' + params.toString();
  window.location.href = newUrl;
}
</script>

{% endblock %}
