{% extends "base.html" %}
{% block content %}
<div class="articles-container">
  <!-- Simple Header -->
  <div class="page-header">
    <h1 class="page-title">
      ğŸ“š Articles{% if current_source %} from {{ current_source|title }}{% endif %}{% if current_date %} from {{ current_date }}{% endif %}
    </h1>
    <p class="page-subtitle">{{ articles|length if articles else 0 }} article{{ 's' if articles|length != 1 else '' }} found</p>
  </div>

  <!-- Filter Controls -->
  <div class="filter-controls">
    <!-- Date Filter Dropdown -->
    <div class="filter-group">
      <label for="date-filter" class="filter-label">ğŸ“… Date:</label>
      <select id="date-filter" class="filter-dropdown" onchange="filterByDate(this.value)">
        <option value="">All Dates</option>
        {% if available_dates %}
          {% for date in available_dates %}
            <option value="{{ date }}" {% if current_date == date %}selected{% endif %}>
              {{ date }}
            </option>
          {% endfor %}
        {% endif %}
      </select>
    </div>

    <!-- Source Filter Links -->
    <div class="filter-group">
      <span class="filter-label">ğŸ”— Source:</span>
      <div class="filter-nav">
        <a href="/articles/{% if current_date %}?date={{ current_date }}{% endif %}" class="filter-link {% if not current_source %}active{% endif %}">All Sources</a>
        <a href="/articles/?source=reddit{% if current_date %}&date={{ current_date }}{% endif %}" class="filter-link {% if current_source == 'reddit' %}active{% endif %}">Reddit</a>
        <a href="/articles/?source=hackernews{% if current_date %}&date={{ current_date }}{% endif %}" class="filter-link {% if current_source == 'hackernews' %}active{% endif %}">HackerNews</a>
        <a href="/articles/?source=unknown{% if current_date %}&date={{ current_date }}{% endif %}" class="filter-link {% if current_source == 'unknown' %}active{% endif %}">Unknown</a>
      </div>
    </div>

    <!-- Action Area -->
    <div class="filter-group action-group">
      <a href="/links/add" class="btn btn-primary btn-sm">â• Add Article</a>
      {% if current_source or current_date %}
        <a href="/articles/" class="btn btn-secondary btn-sm">ğŸ”„ Clear Filters</a>
      {% endif %}
    </div>
  </div>

  <!-- Articles Table -->
  {% if articles %}
  <div class="articles-table-container">
    <table class="articles-table">
      <thead>
        <tr>
          <th class="col-date">ğŸ“… Date</th>
          <th class="col-source">ğŸ”— Source</th>
          <th class="col-title">ğŸ“° Title</th>
          <th class="col-description">ğŸ“ Description</th>
          <th class="col-actions">âš¡ Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for article in articles %}
          <tr class="article-row">
            <!-- Date Column -->
            <td class="article-date">
              {{ article.scraped_date.strftime('%Y-%m-%d') if article.scraped_date else 'Unknown' }}
            </td>
            
            <!-- Source Column -->
            <td class="article-source">
              <span class="source-badge source-{{ article.link.source|lower }}">
                {% if article.link.source|lower == 'reddit' %}
                  ğŸ”´ Reddit
                {% elif article.link.source|lower == 'hackernews' %}
                  ğŸŸ  HackerNews
                {% else %}
                  â“ {{ article.link.source|title }}
                {% endif %}
              </span>
            </td>

            <!-- Title Column -->
            <td class="article-title">
              <div class="title-content">
                <a href="/articles/detail/{{ article.id }}" class="title-link">
                  {{ article.title if article.title else article.url }}
                </a>
                {% if article.url and article.title %}
                  <div class="article-url">
                    <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer" class="external-link">
                      ğŸ”— {{ article.url.split('/')[2] if '/' in article.url else article.url[:30] }}
                    </a>
                  </div>
                {% endif %}
              </div>
            </td>

            <!-- Description Column -->
            <td class="article-description">
              {% if article.short_summary %}
                <p class="summary-text">{{ article.short_summary[:150] }}{% if article.short_summary|length > 150 %}...{% endif %}</p>
              {% else %}
                <span class="no-summary">No summary available</span>
              {% endif %}
            </td>

            <!-- Actions Column -->
            <td class="article-actions">
              <div class="action-buttons">
                <a href="/articles/detail/{{ article.id }}" class="btn btn-sm btn-primary" title="Read Full Article">ğŸ“–</a>
                {% if article.url %}
                  <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary" title="Open Original">ğŸ”—</a>
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% else %}
    <!-- Simple Empty State -->
    <div class="empty-state">
      <div class="empty-icon">ğŸ“°</div>
      <h3>No articles found</h3>
      <p>
        {% if current_source and current_date %}
          No articles are available for {{ current_source|title }} on {{ current_date }}.
        {% elif current_source %}
          No articles are currently available for {{ current_source|title }}.
        {% elif current_date %}
          No articles are available for {{ current_date }}.
        {% else %}
          Your article collection is empty. Start by adding some links!
        {% endif %}
      </p>
      <div class="empty-actions">
        <a href="/links/add" class="btn btn-primary">Add Your First Article</a>
        {% if current_source or current_date %}
          <a href="/articles/" class="btn btn-secondary">View All Articles</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>

<script>
function filterByDate(selectedDate) {
  const currentUrl = new URL(window.location);
  const params = new URLSearchParams(currentUrl.search);
  
  if (selectedDate) {
    params.set('date', selectedDate);
  } else {
    params.delete('date');
  }
  
  // Preserve existing source filter
  const newUrl = currentUrl.pathname + '?' + params.toString();
  window.location.href = newUrl;
}
</script>

{% endblock %}
