{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <!-- Header and Date Filter -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 pb-2">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">
        Articles
      </h1>
      <p class="mt-1 text-sm text-gray-500">
        {% if current_date %}
          Displaying articles for <span class="font-semibold text-blue-600">{{ current_date }}</span>
        {% else %}
          Displaying all articles
        {% endif %}
      </p>
    </div>
    
    <!-- Date Filter Dropdown -->
    <div class="mt-4 sm:mt-0">
      <label for="date-filter" class="sr-only">Filter by date</label>
      <select id="date-filter" class="block w-full sm:w-auto pl-3 pr-10 py-2 text-base bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md border-transparent" onchange="filterByDate(this.value)">
        <option value="">All Dates</option>
        {% for date in available_dates %}
          <option value="{{ date }}" {% if current_date == date %}selected{% endif %}>
            {{ date }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>

  <!-- Articles List -->
  {% if articles %}
    <div class="space-y-4">
        {% for article in articles %}
          <div class="bg-white p-4 rounded-lg hover:shadow-md transition-shadow duration-200">
            <!-- Top Line: Source and Title -->
            <div class="flex items-center text-base">
              <span class="font-bold text-sm text-gray-600 uppercase tracking-wide">{{ article.link.source }}</span>
            <span class="mx-2 text-gray-300">|</span>
            <a href="/articles/detail/{{ article.id }}" class="text-lg font-semibold text-gray-800 hover:text-blue-600 hover:underline">
              {{ article.title if article.title else "Untitled Article" }}
            </a>
          </div>
          
          <!-- Short Summary -->
          {% if article.short_summary %}
            <p class="mt-2 text-sm text-gray-600 italic">
              {{ article.short_summary }}
            </p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <!-- Empty State -->
    <div class="text-center py-16 px-6 bg-gray-50 rounded-lg">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900">No articles found</h3>
      <p class="mt-1 text-sm text-gray-500">
        {% if current_date %}
          There are no articles for the selected date.
        {% else %}
          There are no articles available at the moment.
        {% endif %}
      </p>
      {% if current_date %}
        <div class="mt-6">
          <a href="/articles/" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            View All Articles
          </a>
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>

<script>
function filterByDate(selectedDate) {
  const currentUrl = new URL(window.location);
  const params = new URLSearchParams(currentUrl.search);
  
  if (selectedDate) {
    params.set('date', selectedDate);
  } else {
    params.delete('date');
  }
  
  // Reset to the base path and apply new params
  window.location.href = currentUrl.pathname + '?' + params.toString();
}
</script>
{% endblock %}
