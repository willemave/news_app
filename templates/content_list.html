{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Filters Section -->
  <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
    <form method="get" action="/" class="flex flex-wrap gap-4 items-end" id="filterForm">
      <!-- Content Type Filter -->
      <div class="flex-1 min-w-[200px]">
        <label for="content_type" class="block text-sm font-medium text-gray-700 mb-1">
          Content Type
        </label>
        <select name="content_type" id="content_type" 
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="document.getElementById('filterForm').submit()">
          <option value="all" {% if not selected_type or selected_type == 'all' %}selected{% endif %}>All</option>
          {% for ct in content_types %}
            <option value="{{ ct }}" {% if selected_type == ct %}selected{% endif %}>
              {{ ct.replace('_', ' ').title() }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Date Filter -->
      <div class="flex-1 min-w-[200px]">
        <label for="date" class="block text-sm font-medium text-gray-700 mb-1">
          Date
        </label>
        <select name="date" id="date" 
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="document.getElementById('filterForm').submit()">
          <option value="">All Dates</option>
          {% for date in available_dates %}
            <option value="{{ date }}" {% if selected_date == date %}selected{% endif %}>{{ date }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Read Status Filter -->
      <div class="flex-1 min-w-[200px]">
        <label for="read_filter" class="block text-sm font-medium text-gray-700 mb-1">
          Read Status
        </label>
        <select name="read_filter" id="read_filter" 
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="document.getElementById('filterForm').submit()">
          <option value="unread" {% if selected_read_filter == 'unread' %}selected{% endif %}>Unread Only</option>
          <option value="all" {% if selected_read_filter == 'all' %}selected{% endif %}>All Content</option>
          <option value="read" {% if selected_read_filter == 'read' %}selected{% endif %}>Read Only</option>
        </select>
      </div>

      <!-- Filter Button -->
      <button type="submit" 
              class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
        Apply Filters
      </button>
    </form>
  </div>

  <!-- Content List -->
  <div class="space-y-4">
    {% if not contents %}
      <div class="bg-white rounded-lg shadow-sm p-8 text-center">
        <p class="text-gray-500">No content found matching your filters.</p>
      </div>
    {% else %}
      {% for content in contents %}
        <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow {% if content.id in read_content_ids %}opacity-75{% endif %}">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-semibold flex-1 flex items-center gap-2">
              <a href="/content/{{ content.id }}" class="{% if content.id in read_content_ids %}text-gray-600{% else %}text-gray-900{% endif %} hover:text-blue-600 transition-colors">
                {{ content.title or "Untitled" }}
              </a>
              {% if content.id in read_content_ids %}
                <span class="text-xs text-gray-500 font-normal">(read)</span>
              {% endif %}
            </h2>
            <span class="ml-4 px-2 py-1 text-xs font-medium rounded-full 
                         {% if content.content_type == 'article' %}bg-blue-100 text-blue-800
                         {% elif content.content_type == 'podcast' %}bg-purple-100 text-purple-800
                         {% else %}bg-gray-100 text-gray-800{% endif %}">
              {{ content.content_type.replace('_', ' ').title() }}
            </span>
          </div>
          
          <div class="text-sm text-gray-600 mb-2">
            <time datetime="{{ content.created_at }}">
              {{ content.created_at.strftime('%B %d, %Y at %I:%M %p') if content.created_at else 'Date unknown' }}
            </time>
            {% if content.source %}
              <span class="mx-1">â€¢</span>
              <span>{{ content.source }}</span>
            {% endif %}
          </div>
          
          {% if content.summary %}
            <p class="text-gray-700">{{ content.summary }}</p>
          {% else %}
            <p class="text-gray-500 italic">No summary available</p>
          {% endif %}
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>
{% endblock %}